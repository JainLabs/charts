// Copyright (C) 2012 JainLabs, Ajay Jain, Paras Jain
// This software is icensed under a Creative Commons Attribution-NonCommercial 3.0 Unported License, found at http://creativecommons.org/licenses/by-nc/3.0/.
var charts={};(function(e,t,n){var r=function(e){var t=JSON.parse({"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"});return e==null?String(e):t[toString.call(e)]||"object"},i=function(e){if(!e||r(e)!=="object"||e.nodeType||e!=null&&e==e.window)return!1;try{if(e.constructor&&!hasOwn.call(e,"constructor")&&!hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var i;for(i in e);return i===n||hasOwn.call(e,i)},s=Array.isArray||function(e){return r(e)==="array"};t.extend=function(){var e,r,o,u,a,f,l=arguments[0]||{},c=1,h=arguments.length,p=!1;typeof l=="boolean"&&(p=l,l=arguments[1]||{},c=2),typeof l!="object"&&typeof l!="function"&&(l={}),h===c&&(l=t,--c);for(;c<h;c++)if((e=arguments[c])!=null)for(r in e){o=l[r],u=e[r];if(l===u)continue;p&&u&&(i(u)||(a=s(u)))?(a?(a=!1,f=o&&s(o)?o:[]):f=o&&i(o)?o:{},l[r]=t.extend(p,f,u)):u!==n&&(l[r]=u)}return l}})(this,charts),charts.extend({donut:function(e){function d(e){var t=(e.startAngle+e.endAngle)*90/Math.PI-90;return t>90?t-180:t}var t=[],n=[],r=[],i=d3.scale.category20();(function(){for(var s=0,o=e.sections.length;s<o;s++){var u=e.sections[s].data,a=e.sections[s].label,f=e.sections[s].color;a=a&&a!==""&&a!=="undefined"?a:"",f=f&&f!==""&&f!=="undefined"?f:i(s);if(typeof u!="number"||u===0)continue;t[s]=u,n[s]=a,r[s]=f}})();var s=e.centerLabel||"",o=e.container||"body",u=e.width||400,a=e.height||400,f=u/2,l=d3.layout.pie().sort(null),c=d3.svg.arc().innerRadius(1.2*f/3).outerRadius(f),h=d3.select(o).append("svg:svg").attr("width",u).attr("height",a).append("svg:g").attr("transform","translate("+u/2+","+a/2+")"),p=h.selectAll("g").data(l(t)).enter().append("svg:g");p.append("svg:path").attr("d",c).style("fill",function(e,t){return r[t]}).style("stroke","#fff").append("svg:title").text(function(e){return String(e.data)+" votes"}),p.append("svg:text").attr("dy","0.35em").attr("text-anchor","middle").attr("transform",function(e){return"translate("+c.centroid(e)+")rotate("+d(e)+")"}).style("font",f/13+"px sans-serif").style("fill","white").text(function(e,t){return n[t]}),h.append("svg:text").attr("dy",".35em").attr("text-anchor","middle").style("font","bold "+f/10+"px Helvetica, Georgia").text(s)}}),charts.extend({gauge:function(e){function t(e){this.placeholderName=e.container&&e.container!==""&&e.container!=="undefined"?e.container:"body";var t=this;this.configure=function(e){this.config=e,this.config.value=e.value||0,this.config.size=this.config.size*.9;if(!this.config.size||this.config.size<=0)this.config.size=108;this.config.raduis=this.config.size*.97/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=e.min||0,this.config.max=e.max||100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=e.majorTicks||5,this.config.minorTicks=e.minorTicks||2,this.config.redZones=[],this.config.redZones.push(e.zones.red),this.config.yellowZones=[],this.config.yellowZones.push(e.zones.yellow),this.config.greenZones=[],this.config.greenZones.push(e.zones.green),this.config.greenColor=e.greenColor||"#109618",this.config.yellowColor=e.yellowColor||"#FF9900",this.config.redColor=e.redColor||"#DC3912"},this.render=function(){this.body=d3.select(this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.raduis).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px");for(var e in this.config.greenZones)this.drawBand(this.config.greenZones[e].from,this.config.greenZones[e].to,t.config.greenColor);for(var e in this.config.yellowZones)this.drawBand(this.config.yellowZones[e].from,this.config.yellowZones[e].to,t.config.yellowColor);for(var e in this.config.redZones)this.drawBand(this.config.redZones[e].from,this.config.redZones[e].to,t.config.redColor);if(undefined!=this.config.label){var n=Math.round(this.config.size/9);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+n/2).attr("dy",n/2).attr("text-anchor","middle").text(this.config.label).style("font-size",n+"px").style("font-family","Arial").style("fill","#333").style("stroke-width","0px")}var n=Math.round(this.config.size/16),r=this.config.range/(this.config.majorTicks-1);for(var i=this.config.min;i<=this.config.max;i+=r){var s=r/this.config.minorTicks;for(var o=i+s;o<Math.min(i+r,this.config.max);o+=s){var u=this.valueToPoint(o,.75),a=this.valueToPoint(o,.85);this.body.append("svg:line").attr("x1",u.x).attr("y1",u.y).attr("x2",a.x).attr("y2",a.y).style("stroke","#666").style("stroke-width","1px")}var u=this.valueToPoint(i,.7),a=this.valueToPoint(i,.85);this.body.append("svg:line").attr("x1",u.x).attr("y1",u.y).attr("x2",a.x).attr("y2",a.y).style("stroke","#333").style("stroke-width","2px");if(i==this.config.min||i==this.config.max){var f=this.valueToPoint(i,.63);this.body.append("svg:text").attr("x",f.x).attr("y",f.y).attr("dy",n/3).attr("text-anchor",i==this.config.min?"start":"end").text(i).style("font-size",n+"px").style("font-family","Arial").style("fill","#333").style("stroke-width","0px")}}var l=this.body.append("svg:g").attr("class","pointerContainer");return this.drawPointer(0),l.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#4684EE").style("stroke","#666").style("opacity",1),this},this.redraw=function(e){return this.drawPointer(e),this},this.drawBand=function(e,n,r){if(0>=n-e)return;this.body.append("svg:path").style("fill",r).attr("d",d3.svg.arc().startAngle(this.valueToRadians(e)).endAngle(this.valueToRadians(n)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+t.config.cx+", "+t.config.cy+") rotate(270)"})},this.drawPointer=function(e){var t=this.config.range/13,n=this.valueToPoint(e,.85),r=this.valueToPoint(e-t,.12),i=this.valueToPoint(e+t,.12),s=e-this.config.range*(1/.75)/2,o=this.valueToPoint(s,.28),u=this.valueToPoint(s-t,.12),a=this.valueToPoint(s+t,.12),f=[n,r,a,o,u,i,n],l=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("basis"),c=this.body.select(".pointerContainer"),h=c.selectAll("path").data([f]);h.enter().append("svg:path").attr("d",l).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",.7),h.transition().attr("d",l);var p=Math.round(this.config.size/10);c.selectAll("text").data([e]).text(Math.round(e)).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-p).attr("dy",p/2).attr("text-anchor","middle").text(Math.round(e)).style("font-size",p+"px").style("font-family","Arial").style("fill","#000").style("stroke-width","0px")},this.valueToDegrees=function(e){return e/this.config.range*270-45},this.valueToRadians=function(e){return this.valueToDegrees(e)*Math.PI/180},this.valueToPoint=function(e,t){var n={x:this.config.cx-this.config.raduis*t*Math.cos(this.valueToRadians(e)),y:this.config.cy-this.config.raduis*t*Math.sin(this.valueToRadians(e))};return n},this.configure(e)}var n=(new t(e)).render();return n.redraw(n.config.value)}}),charts.extend({groupedLine:function(e){var t="groupedLine"+Math.round(Math.random()*1e6),n=function(t){var n=[];for(var r in t)if(t.hasOwnProperty(r)){t[r]=t[r].sort();if(e.time)var i=(new Date(r)).getTime();else var i=r;for(var s in t[r])n.push({x:i,y:t[r][s]})}return n},r=function(e){var t,n=e.length,r=[],i=[],s=e.sort();for(t=0;t<n-1;t++)(s[t+1].y!==s[t].y||s[t+1].x!==s[t].x)&&r.push(e[t]);return r.push(e[--n]),i=e.filter(function(e){return!(r.indexOf(e)>-1)}),{noDupe:r,dupe:i}},i=r(n(e.data)),s=i.dupe;console.log(i),i=i.noDupe,console.log(i);var o={};e.margin=e.margin||{},o.top=typeof e.margin.top=="number"?e.margin.top:20,o.right=typeof e.margin.right=="number"?e.margin.right:20,o.bottom=typeof e.margin.bottom=="number"?e.margin.bottom:30,o.left=typeof e.margin.left=="number"?e.margin.left:40,e.width=e.width&&typeof e.width=="number"?e.width:500,e.height=e.height&&typeof e.height=="number"?e.height:400,e.container=e.container&&e.container!==""&&e.container!=="undefined"?e.container:"body",e.color=e.color&&e.color!==""&&e.color!=="undefined"?e.color:"steelblue",e.title=e.title&&e.title!==""&&e.title!=="undefined"?e.title:"",e.xlabel=e.xlabel&&e.xlabel!==""&&e.xlabel!=="undefined"?e.xlabel:"",e.ylabel=e.ylabel&&e.ylabel!==""&&e.ylabel!=="undefined"?e.ylabel:"";var u=e.width-o.left-o.right,a=e.height-o.top-o.bottom,f=e.xMarker||!1;f&&typeof f=="number"&&!e.time&&(f=e.xMarker);if(f&&e.time)var f=(new Date(e.xMarker)).getTime();var l=e.yMarker&&typeof e.yMarker=="number"?e.yMarker:!1;if(e.time===!0){for(var c=0,h=i.length;c<h;c++)i[c].x=parseFloat((new Date(i[c].x)).getTime());i.sort(function(e,t){var n=new Date(e.x),r=new Date(t.x);return n<r?-1:n>r?1:0});var p=e.xMax?new Date(e.xMax):0;p===0&&function(){p=new Date(i[0].x);var e;for(var t=0,n=i.length;t<n;t++)e=new Date(i[t].x),e>p&&(p=e)}();var d=e.xMin?new Date(e.xMin):0;d===0&&function(){d=new Date(i[0].x);var e;for(var t=0,n=i.length;t<n;t++)e=new Date(i[t].x),e<d&&(d=e)}();var v=d3.time.scale().domain([new Date(d),new Date(p)]).range([0,u])}else{var p=e.xMax&&typeof e.xMax=="number"?e.xMax:0;p===0&&function(){var e={};for(var t=0,n=i.length;t<n;t++)e=i[t],e.x>p&&(p=e.x)}();var v=d3.scale.linear().domain([0,p]).range([0,u])}var m=e.yMax&&typeof e.yMax=="number"?e.yMax:0;m===0&&function(){var e=m===0?!0:!1,t={};for(var n=0,r=i.length;n<r;n++)t=i[n],e&&t.y>m&&(m=t.y)}();var g=d3.scale.linear().domain([0,m]).range([a,0]),y=d3.svg.axis().scale(v).orient("bottom"),b=d3.svg.axis().scale(g).orient("left"),w=d3.svg.line().x(function(e){return v(e.x)}).y(function(e){return g(e.y)}),E=d3.select(e.container).append("svg").datum(i).attr("id",t).attr("class","lineChart").attr("width",u+o.left+o.right).attr("height",a+o.top+o.bottom).style("font","10px sans-serif").append("g").attr("transform","translate("+o.left+","+o.top+")");E.append("svg:text").attr("x",u/2+"px").attr("text-anchor","middle").style("font-weight","bold").style("font-size","16px").text(e.title),E.append("svg:text").attr("x",u/2+"px").attr("y",a+29+"px").attr("text-anchor","middle").style("font-weight","bold").style("font-size","12px").text(e.xlabel),E.append("svg:text").attr("x",-a/2+"px").attr("y","-29px").attr("text-anchor","middle").attr("transform","rotate(-90)").style("font-weight","bold").style("font-size","12px").text(e.ylabel);if(f){var S=v(f).toString();E.append("line").attr("x1",S).attr("y1","0").attr("x2",S).attr("y2",a.toString()).style("stroke","black")}if(l){var x=g(l).toString();E.append("line").attr("x1","0").attr("y1",x).attr("x2",u.toString()).attr("y2",x).style("stroke","black")}E.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(y),E.append("g").attr("class","y axis").call(b),e.popover&&jQuery?(E.selectAll(".dot").data(i).enter().append("circle").attr("class","dot").attr("cx",w.x()).attr("cy",w.y()).attr("r",3.5).attr("rel","popover").attr("data-title",function(e){return e.y}).attr("data-content",function(t){return e.xlabel+": "+(new Date(t.x)).toLocaleDateString()+"<br>"+e.ylabel+": "+t.y}).style("fill",function(t){if(e.boxColors&&l){if(t.y<l)return e.boxColors.belowLine||e.color;if(t.y>l)return e.boxColors.aboveLine||e.color;if(t.y==l)return e.boxColors.onLine||e.color}return e.color}).style("stroke",function(t){if(e.boxColors&&l){if(t.y<l)return e.boxColors.belowLine||e.color;if(t.y>l)return e.boxColors.aboveLine||e.color;if(t.y==l)return e.boxColors.onLine||e.color}return e.color}).style("stroke-width","1.5px"),E.selectAll(".circle").data(s).enter().append("circle").attr("class","dot").attr("cx",w.x()).attr("cy",w.y()).attr("r",6.5).attr("rel","popover").attr("data-title",function(e){return e.y}).attr("data-content",function(t){return e.xlabel+": "+(new Date(t.x)).toLocaleDateString()+"<br>"+e.ylabel+": "+t.y}).style("fill","none").style("stroke",function(t){if(e.boxColors&&l){if(t.y<l)return e.boxColors.belowLine||e.color;if(t.y>l)return e.boxColors.aboveLine||e.color;if(t.y==l)return e.boxColors.onLine||e.color}return e.color}).style("stroke-width","2px"),jQuery("circle").popover()):(E.selectAll(".dot").data(i).enter().append("circle").attr("class","dot").attr("cx",w.x()).attr("cy",w.y()).attr("r",3.5).style("fill",function(t){if(e.boxColors&&l){if(t.y<l)return e.boxColors.belowLine||e.color;if(t.y>l)return e.boxColors.aboveLine||e.color;if(t.y==l)return e.boxColors.onLine||e.color}return e.color}).style("stroke",function(t){if(e.boxColors&&l){if(t.y<l)return e.boxColors.belowLine||e.color;if(t.y>l)return e.boxColors.aboveLine||e.color;if(t.y==l)return e.boxColors.onLine||e.color}return e.color}).style("stroke-width","1.5px"),E.selectAll(".circle").data(s).enter().append("circle").attr("class","dot").attr("cx",w.x()).attr("cy",w.y()).attr("r",6.5).style("fill","none").style("stroke",function(t){if(e.boxColors&&l){if(t.y<l)return e.boxColors.belowLine||e.color;if(t.y>l)return e.boxColors.aboveLine||e.color;if(t.y==l)return e.boxColors.onLine||e.color}return e.color}).style("stroke-width","2px")),function(){for(var t in e.data)if(e.data.hasOwnProperty(t)){var n=e.data[t].sort(),r=n[n.length-1],i=n[0],s=v((new Date(t)).valueOf()),o=g(r),u;if(e.boxColors&&l){if(r<l)var a="belowLine";if(i>l)var a="aboveLine";if(r>l&&i<l)var a="onLine";u=e.boxColors[a]||e.color}else u=e.color;E.append("svg:rect").attr("class","box").attr("x",s-5).attr("y",o-5).attr("width",10).attr("height",g(i)-o+10).style("fill","none").style("stroke",u).style("stroke-width","1.5px")}}();var T=document.createElement("style");return document.head.appendChild(T),T.innerHTML=".lineChart .axis path, .lineChart .axis line {  fill: none;  stroke: #000;  shape-rendering: crispEdges;}",{id:t,obj:e,remove:function(){var e=document.getElementById(this.id),t=document.createElement("div");return t.setAttribute("id",this.id),e.parentNode.replaceChild(t,e),this},redraw:function(e){return this.remove(),this.obj.data=e,this.obj.container="#"+this.id,console.log(this.obj),charts.groupedLine(this.obj)},add:function(e){return this.redraw(charts.extend(this.obj.data,e)),this}}}}),charts.extend({line:function(e){var t="line"+Math.round(Math.random()*1e6),n=e.data,r={};e.margin=e.margin||{},r.top=typeof e.margin.top=="number"?e.margin.top:20,r.right=typeof e.margin.right=="number"?e.margin.right:20,r.bottom=typeof e.margin.bottom=="number"?e.margin.bottom:30,r.left=typeof e.margin.left=="number"?e.margin.left:40,e.width=e.width&&typeof e.width=="number"?e.width:500,e.height=e.height&&typeof e.height=="number"?e.height:400,e.container=e.container&&e.container!==""&&e.container!=="undefined"?e.container:"body",e.color=e.color&&e.color!==""&&e.color!=="undefined"?e.color:"steelblue",e.title=e.title&&e.title!==""&&e.title!=="undefined"?e.title:"",e.xlabel=e.xlabel&&e.xlabel!==""&&e.xlabel!=="undefined"?e.xlabel:"",e.ylabel=e.ylabel&&e.ylabel!==""&&e.ylabel!=="undefined"?e.ylabel:"";var i=e.width-r.left-r.right,s=e.height-r.top-r.bottom,o=e.xMarker||!1;o&&typeof o=="number"&&!e.time&&(o=e.xMarker);if(o&&e.time)var o=(new Date(e.xMarker)).getTime();var u=e.yMarker&&typeof e.yMarker=="number"?e.yMarker:!1;if(e.time===!0){for(var a=0,f=n.length;a<f;a++)n[a].x=parseFloat((new Date(n[a].x)).getTime());n.sort(function(e,t){var n=new Date(e.x),r=new Date(t.x);return n<r?-1:n>r?1:0});var l=e.xMax?new Date(e.xMax):0;l===0&&function(){l=new Date(n[0].x);var e;for(var t=0,r=n.length;t<r;t++)e=new Date(n[t].x),e>l&&(l=e)}();var c=e.xMin?new Date(e.xMin):0;c===0&&function(){c=new Date(n[0].x);var e;for(var t=0,r=n.length;t<r;t++)e=new Date(n[t].x),e<c&&(c=e)}();var h=d3.time.scale().domain([new Date(c),new Date(l)]).range([0,i])}else{var l=e.xMax&&typeof e.xMax=="number"?e.xMax:0;l===0&&function(){var e={};for(var t=0,r=n.length;t<r;t++)e=n[t],e.x>l&&(l=e.x)}();var h=d3.scale.linear().domain([0,l]).range([0,i])}var p=e.yMax&&typeof e.yMax=="number"?e.yMax:0;p===0&&function(){var e=p===0?!0:!1,t={};for(var r=0,i=n.length;r<i;r++)t=n[r],e&&t.y>p&&(p=t.y)}();var d=d3.scale.linear().domain([0,p]).range([s,0]),v=d3.svg.axis().scale(h).orient("bottom"),m=d3.svg.axis().scale(d).orient("left"),g=d3.svg.line().x(function(e){return h(e.x)}).y(function(e){return d(e.y)}),y=d3.select(e.container).append("svg").datum(n).attr("id",t).attr("class","lineChart").attr("width",i+r.left+r.right).attr("height",s+r.top+r.bottom).style("font","10px sans-serif").append("g").attr("transform","translate("+r.left+","+r.top+")");y.append("svg:text").attr("x",i/2+"px").attr("text-anchor","middle").style("font-weight","bold").style("font-size","16px").text(e.title),y.append("svg:text").attr("x",i/2+"px").attr("y",s+29+"px").attr("text-anchor","middle").style("font-weight","bold").style("font-size","12px").text(e.xlabel),y.append("svg:text").attr("x",-s/2+"px").attr("y","-29px").attr("text-anchor","middle").attr("transform","rotate(-90)").style("font-weight","bold").style("font-size","12px").text(e.ylabel);if(o){var b=h(o).toString();y.append("line").attr("x1",b).attr("y1","0").attr("x2",b).attr("y2",s.toString()).style("stroke","black")}if(u){var w=d(u).toString();y.append("line").attr("x1","0").attr("y1",w).attr("x2",i.toString()).attr("y2",w).style("stroke","black")}y.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(v),y.append("g").attr("class","y axis").call(m),y.append("path").attr("class","line").attr("d",g).style("fill","none").style("stroke",e.color).style("stroke-width","1.5px"),y.selectAll(".dot").data(n).enter().append("circle").attr("class","dot").attr("cx",g.x()).attr("cy",g.y()).attr("r",3.5).style("fill","white").style("stroke",e.color).style("stroke-width","1.5px");var E=document.createElement("style");return document.head.appendChild(E),E.innerHTML=".lineChart .axis path, .lineChart .axis line {  fill: none;  stroke: #000;  shape-rendering: crispEdges;}",{id:t,obj:e,remove:function(){var e=document.getElementById(this.id),t=document.createElement("div");return t.setAttribute("id",this.id),e.parentNode.replaceChild(t,e),this},redraw:function(e){return this.remove(),this.obj.data=e,this.obj.container="#"+this.id,charts.line(this.obj)},add:function(e){return this.redraw(this.obj.data.concat(e)),this}}}}),charts.extend({behavior:function(e,t,n,r){var i=e.positive,s=e.negative,o=e.neutral,u=[];Object.size=function(e){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t},function(){var t=["positive","negative","neutral"];for(var n in t){var r=t[n],i=Object.size(e[r]),s=d3.scale.linear().domain([0,i]).range([100,256]),o=0;for(var a in e[r]){if(r==="positive")var f="rgb(0,"+s(o)+",0)";if(r==="negative")var f="rgb("+s(o)+",0,0)";if(r==="neutral")var f="rgb("+s(o)+","+s(o)+","+s(o)+")";u.push({data:e[r][a],label:a,color:f}),o++}}}(),this.donut({sections:u,centerLabel:"Behavior",container:t,width:n,height:r})}}),charts.extend({DRA:function(e){var t=[],n=e.scores;e.container=e.container&&e.container!==""&&e.container!=="undefined"?e.container:"body",e.color=e.color&&e.color!==""&&e.color!=="undefined"?e.color:"",e.width=e.width&&typeof e.width=="number"?e.width:undefined,e.height=e.height&&typeof e.height=="number"?e.height:undefined;for(var r in n)n.hasOwnProperty(r)&&t.push({x:r,y:n[r]});t.sort(function(e,t){return e.x<t.x?-1:e.x>t.x?1:0});var i={time:!0,data:t,title:"Reading Level",xlabel:"Time",ylabel:"DRA Score",xMarker:e.deadline,yMarker:e.goal,container:e.container,width:e.width,height:e.height,color:e.color},s=this.line(i);return s.obj=e,s.redraw=function(e){return this.remove(),this.obj.scores=e,this.obj.container="#"+this.id,charts.DRA(this.obj)},s.add=function(e){this.redraw(charts.extend(this.obj.scores,e))},s}})